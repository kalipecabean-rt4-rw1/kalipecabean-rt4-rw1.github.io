<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mutasi Rekening - POS RT RW</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-4">

    <div class="container mx-auto max-w-md bg-white rounded-lg shadow-md">
        <div class="p-4 border-b">
            <h1 class="text-xl font-bold text-gray-800">Penerimaan & Belanja</h1>
            <p class="text-sm text-gray-500">Project POS RT RW</p>
        </div>

        <div class="p-4 border-b">
            <input 
                type="text" 
                id="searchInput" 
                placeholder="Cari Keterangan atau No. Reff..." 
                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            >
            <button 
                id="sortButton" 
                class="w-full mt-2 px-3 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500"
            >
                Urutkan: Terlama
            </button>
        </div>
        <div class="overflow-x-auto">
            <table class="min-w-full text-sm">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="p-3 text-left font-semibold text-gray-600">Keterangan</th>
                        <th class="p-3 text-right font-semibold text-gray-600">Mutasi</th>
                        <th class="p-3 text-right font-semibold text-gray-600">Saldo</th>
                        <th class="p-3 text-center font-semibold text-gray-600">Action</th>
                    </tr>
                </thead>
                <tbody id="transactionTableBody" class="divide-y divide-gray-200">
                    <tr>
                        <td colspan="4" class="p-4 text-center text-gray-500">Memuat data...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', function() {

        // --- FUNGSI UNTUK MEMBUAT DATA CONTOH (100 TRANSAKSI) ---
        function generateSampleData() {
            const data = [];
            let currentSaldo = 2500000; // Saldo awal
            const descriptionsIn = ["Iuran Warga", "Sumbangan Acara 17an", "Donasi Pembangunan", "Sewa Fasilitas RT"];
            const descriptionsOut = ["Beli ATK Rapat", "Biaya Kebersihan Lingkungan", "Konsumsi Rapat Warga", "Perbaikan Lampu Jalan", "Fotokopi Undangan"];
            
            for (let i = 100; i > 0; i--) {
                const isIncome = Math.random() > 0.4; // Peluang 60% pemasukan
                const date = new Date(2025, 9, 25 - Math.floor(i / 5)); // Menghasilkan tanggal mundur
                date.setHours(Math.floor(Math.random() * 23));
                date.setMinutes(Math.floor(Math.random() * 59));
                
                const amount = isIncome ? Math.floor(Math.random() * 20 + 1) * 25000 : Math.floor(Math.random() * 15 + 1) * 10000;
                
                if (isIncome) {
                    currentSaldo += amount;
                } else {
                    currentSaldo -= amount;
                }

                data.push({
                    tanggal: `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')} ${String(date.getHours()).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}`,
                    noReff: `REF-${String(1000 + i).padStart(5, '0')}`,
                    keterangan: isIncome ? descriptionsIn[i % descriptionsIn.length] : descriptionsOut[i % descriptionsOut.length],
                    tipe: isIncome ? 'masuk' : 'keluar',
                    jumlah: amount,
                    saldo: currentSaldo
                });
            }
            return data.reverse(); // Balik array agar tanggal terbaru di awal
        }

        // --- BAGIAN UTAMA SCRIPT ---
        
        // 1. Definisikan Variabel Global dan Sumber Data
        const allTransactions = generateSampleData();
        let isDescending = true; // Urutan awal: Terbaru ke Terlama

        const searchInput = document.getElementById('searchInput');
        const sortButton = document.getElementById('sortButton');
        const tableBody = document.getElementById('transactionTableBody');

        // 2. Helper Function untuk Format Mata Uang
        const formatCurrency = (amount) => {
            return new Intl.NumberFormat('id-ID', { 
                style: 'currency', 
                currency: 'IDR', 
                minimumFractionDigits: 0 
            }).format(amount);
        };

        // 3. Fungsi Utama untuk Menampilkan Data ke Tabel
        const renderTable = (transactions) => {
            tableBody.innerHTML = ''; // Kosongkan tabel sebelum diisi data baru

            if (transactions.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="4" class="p-4 text-center text-gray-500">Data tidak ditemukan.</td></tr>';
                return;
            }

            transactions.forEach(trx => {
                const row = document.createElement('tr');
                row.setAttribute('data-date', trx.tanggal);

                const mutationClass = trx.tipe === 'masuk' ? 'text-green-600' : 'text-red-600';
                const mutationPrefix = trx.tipe === 'masuk' ? '+' : '-';

                row.innerHTML = `
                    <td class="p-3">
                        <p class="font-medium text-gray-800">${trx.keterangan}</p>
                        <p class="text-xs text-gray-500">${trx.tanggal}</p>
                        <p class="text-xs text-gray-400">${trx.noReff}</p>
                    </td>
                    <td class="p-3 text-right">
                        <span class="font-semibold ${mutationClass}">${mutationPrefix} ${formatCurrency(trx.jumlah)}</span>
                    </td>
                    <td class="p-3 text-right text-gray-700">${formatCurrency(trx.saldo)}</td>
                    <td class="p-3 text-center">
                        <a href="#" class="text-blue-500 hover:underline text-xs">Lihat Bukti</a>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        };

        // 4. Event Listeners untuk Filter dan Sort
        searchInput.addEventListener('input', function() {
            const query = this.value.toLowerCase();
            const filteredData = allTransactions.filter(trx => 
                trx.keterangan.toLowerCase().includes(query) || 
                trx.noReff.toLowerCase().includes(query)
            );
            renderTable(filteredData);
        });

        sortButton.addEventListener('click', function() {
            isDescending = !isDescending;

            allTransactions.sort((a, b) => {
                const dateA = new Date(a.tanggal);
                const dateB = new Date(b.tanggal);
                return isDescending ? dateB - dateA : dateA - dateB;
            });
            
            this.textContent = `Urutkan: ${isDescending ? 'Terlama' : 'Terbaru'}`;
            
            // Setelah sorting, jalankan kembali filter dengan query yang ada
            searchInput.dispatchEvent(new Event('input'));
        });

        // 5. Render Tabel Pertama Kali Saat Halaman Dimuat
        renderTable(allTransactions);
    });
</script>

</body>
</html>
