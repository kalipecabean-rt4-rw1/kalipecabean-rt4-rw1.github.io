<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mutasi Rekening - POS RT RW</title>
    <script src="https://cdn-tailwindcss.vercel.app/"></script>
</head>
<body class="bg-gray-100">

    <div class="w-full bg-white min-h-screen">
        <div class="p-4 border-b">
            <h1 class="text-xl font-bold text-gray-800">Penerimaan & Belanja</h1>
            <p class="text-sm text-gray-500">Project POS RT RW</p>
        </div>

        <div class="sticky top-0 bg-white z-10 p-4 border-b shadow-sm">
            <div class="relative flex items-center">
                <input 
                    type="text" 
                    id="searchInput" 
                    placeholder="Cari Keterangan atau No. Reff..." 
                    class="w-full pl-3 pr-10 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                >
                <button 
                    id="sortButton" 
                    class="absolute right-0 mr-2 p-1 text-gray-500 hover:text-blue-500 focus:outline-none"
                    aria-label="Urutkan"
                >
                    <svg id="sortIconDesc" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                    <svg id="sortIconAsc" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 hidden" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M14.707 12.707a1 1 0 01-1.414 0L10 9.414l-3.293 3.293a1 1 0 01-1.414-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 010 1.414z" clip-rule="evenodd" />
                    </svg>
                </button>
            </div>
        </div>

        <div class="overflow-x-auto">
            <table class="min-w-full text-sm">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="p-3 text-left font-semibold text-gray-600">Keterangan</th>
                        <th class="p-3 text-right font-semibold text-gray-600 whitespace-nowrap">Mutasi</th>
                        <th class="p-3 text-right font-semibold text-gray-600 whitespace-nowrap">Saldo</th>
                    </tr>
                </thead>
                <tbody id="transactionTableBody">
                    <tr>
                        <td colspan="3" class="p-4 text-center text-gray-500">Memuat data...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', function() {

        // --- FUNGSI DATA CONTOH (Tidak ada perubahan) ---
        function generateSampleData() {
            const data = [];
            let currentSaldo = 2500000;
            const descriptionsIn = ["Iuran Warga", "Sumbangan Acara 17an", "Donasi Pembangunan", "Sewa Fasilitas RT"];
            const descriptionsOut = ["Beli ATK Rapat", "Biaya Kebersihan Lingkungan", "Konsumsi Rapat Warga", "Perbaikan Lampu Jalan", "Fotokopi Undangan"];
            
            for (let i = 100; i > 0; i--) {
                const isIncome = Math.random() > 0.4;
                const date = new Date(2025, 9, 25 - Math.floor(i / 5));
                date.setHours(Math.floor(Math.random() * 23));
                date.setMinutes(Math.floor(Math.random() * 59));
                const amount = isIncome ? Math.floor(Math.random() * 20 + 1) * 25000 : Math.floor(Math.random() * 15 + 1) * 10000;
                if (isIncome) { currentSaldo += amount; } else { currentSaldo -= amount; }
                data.push({
                    tanggal: `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')} ${String(date.getHours()).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}`,
                    noReff: `REF-${String(1000 + i).padStart(5, '0')}`,
                    keterangan: isIncome ? descriptionsIn[i % descriptionsIn.length] : descriptionsOut[i % descriptionsOut.length],
                    tipe: isIncome ? 'masuk' : 'keluar',
                    jumlah: amount,
                    saldo: currentSaldo
                });
            }
            return data.reverse();
        }

        const allTransactions = generateSampleData();
        let isDescending = true;
        const searchInput = document.getElementById('searchInput');
        const sortButton = document.getElementById('sortButton');
        const tableBody = document.getElementById('transactionTableBody');
        
        // PERUBAHAN 2: Mendapatkan elemen ikon
        const sortIconDesc = document.getElementById('sortIconDesc');
        const sortIconAsc = document.getElementById('sortIconAsc');

        const formatCurrency = (amount) => new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(amount);

        const renderTable = (transactions) => {
            tableBody.innerHTML = '';
            if (transactions.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="3" class="p-4 text-center text-gray-500">Data tidak ditemukan.</td></tr>';
                return;
            }
            transactions.forEach(trx => {
                const row = document.createElement('tr');
                row.className = 'odd:bg-white even:bg-slate-100';
                row.setAttribute('data-date', trx.tanggal);
                const mutationClass = trx.tipe === 'masuk' ? 'text-green-600' : 'text-red-600';
                const mutationPrefix = trx.tipe === 'masuk' ? '+' : '-';
                row.innerHTML = `
                    <td class="p-3 align-top">
                        <p class="text-xs text-gray-500">${trx.tanggal}</p>
                        <p class="font-semibold text-gray-800">${trx.keterangan}</p>
                        <p class="text-xs text-gray-400">${trx.noReff}</p>
                        <div class="mt-2"><a href="#" class="text-blue-500 hover:underline text-xs font-semibold">Lihat Bukti</a></div>
                    </td>
                    <td class="p-3 text-right align-top whitespace-nowrap"><span class="font-semibold ${mutationClass}">${mutationPrefix} ${formatCurrency(trx.jumlah)}</span></td>
                    <td class="p-3 text-right align-top whitespace-nowrap"><span class="text-gray-700">${formatCurrency(trx.saldo)}</span></td>
                `;
                tableBody.appendChild(row);
            });
        };

        searchInput.addEventListener('input', function() {
            const query = this.value.toLowerCase();
            const filteredData = allTransactions.filter(trx => trx.keterangan.toLowerCase().includes(query) || trx.noReff.toLowerCase().includes(query));
            renderTable(filteredData);
        });

        sortButton.addEventListener('click', function() {
            isDescending = !isDescending;

            allTransactions.sort((a, b) => {
                const dateA = new Date(a.tanggal);
                const dateB = new Date(b.tanggal);
                return isDescending ? dateB - dateA : dateA - dateB;
            });
            
            // PERUBAHAN 3: Mengganti teks tombol dengan menukar ikon
            if (isDescending) {
                sortIconDesc.classList.remove('hidden');
                sortIconAsc.classList.add('hidden');
            } else {
                sortIconDesc.classList.add('hidden');
                sortIconAsc.classList.remove('hidden');
            }
            
            searchInput.dispatchEvent(new Event('input'));
        });

        renderTable(allTransactions);
    });
</script>

</body>
</html>
